!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("Instantly",[],n):"object"==typeof exports?exports.Instantly=n():t.Instantly=n()}(this,function(){return function(t){function n(i){if(e[i])return e[i].exports;var o=e[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){t.exports=e(3)},function(t,n){function e(t){return i(t)&&s.call(t)==o}function i(t){var n=typeof t;return!!t&&("object"==n||"function"==n)}var o="[object Function]",r=Object.prototype,s=r.toString;t.exports=e},function(t,n){function e(t){return!!t&&"object"==typeof t}function i(t){return"string"==typeof t||e(t)&&s.call(t)==o}var o="[object String]",r=Object.prototype,s=r.toString;t.exports=i},function(t,n,e){"use strict";function i(t,n){if(!t)throw new TypeError("You need to provide a channel we can listen to!");this.channel=t,n||(n={}),n.injectEventSourceNode?this.EventSource=n.injectEventSourceNode:"undefined"!=typeof window&&window.EventSource&&(this.EventSource=window.EventSource),this.origin=n.origin||null,this.retries=n.retries||5,this.timeout=n.timeout||15e3,this.errorHandler=r(n.error)?n.error:null,this.onOpen=r(n.open)?n.open:null,this.onClose=r(n.close)?n.close:null,n.closeConnNotFocus&&document.addEventListener("visibilitychange",this.onVisibilityChange.bind(this))}var o=e(2),r=e(1);i.prototype={initialized:!1,callbacks:{},internalRetry:0,on:function(t,n){if(!r(n))throw new TypeError("Callback is not a function");if(!o(t))throw new TypeError("Event is not a string");this.callbacks[t]=n},listen:function(){if(this.EventSource){this.es=new this.EventSource(this.channel),this.es.addEventListener("open",this.open.bind(this)),this.es.addEventListener("error",this.error.bind(this));for(var t in this.callbacks){if(!this.callbacks.hasOwnProperty(t))return;this.generateCallback(t)}}},generateCallback:function(t){this.es.addEventListener(t,function(n){this.origin&&n.origin!==this.origin||(("CLOSE"===n.id||"CLOSE"===n.lastEventId)&&this.close(),this.callbacks[t].call(null,n))}.bind(this))},retry:function(){this.initialized||this.internalRetry===this.retries||setTimeout(function(){this.listen(),this.internalRetry++}.bind(this),this.timeout)},open:function(t){this.initialized=!0,this.internalRetry=0,this.onOpen&&this.onOpen.call(null,t)},close:function(){this.es.close(),this.initialized=!1,this.onClose&&this.onClose.call(null)},error:function(t){this.close(),this.retry(),this.errorHandler&&this.errorHandler.call(null,t)},onVisibilityChange:function(){document.hidden?this.close():this.listen()}},t.exports=i}])});