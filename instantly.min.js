!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define("Instantly",[],i):"object"==typeof exports?exports.Instantly=i():t.Instantly=i()}(this,function(){return function(t){function i(n){if(e[n])return e[n].exports;var o=e[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}var e={};return i.m=t,i.c=e,i.p="",i(0)}([function(t,i,e){t.exports=e(1)},function(t,i,e){"use strict";function n(t,i){if(!t)throw new TypeError("You need to provide a channel we can listen to!");this.channel=t,i||(i={}),this.origin=i.origin||null,this.retries=i.retries||5,this.timeout=i.timeout||15e3,this.errorHandler=s(i.error)?i.error:null,this.onOpen=s(i.open)?i.open:null,this.onClose=s(i.close)?i.close:null,i.closeConnNotFocus&&document.addEventListener("visibilitychange",this.onVisibilityChange.bind(this))}var o=e(3),s=e(2);n.prototype={initialized:!1,callbacks:{},internalRetry:0,on:function(t,i){if(!s(i))throw new TypeError("Callback is not a function");if(!o(t))throw new TypeError("Event is not a string");this.callbacks[t]=i},listen:function(){if(window.EventSource){this.es=new EventSource(this.channel),this.es.addEventListener("open",this.open.bind(this)),this.es.addEventListener("error",this.error.bind(this));for(var t in this.callbacks){if(!this.callbacks.hasOwnProperty(t))return;this.generateCallback(t)}}},generateCallback:function(t){this.es.addEventListener(t,function(i){this.origin&&i.origin!==this.origin||("CLOSE"===i.id&&this.close(),this.callbacks[t].call(this,i))}.bind(this))},retry:function(){this.initialized||this.internalRetry===this.retries||setTimeout(function(){this.listen(),this.internalRetry++}.bind(this),this.timeout)},open:function(t){this.initialized=!0,this.internalRetry=0,this.onOpen&&this.onOpen.call(this,t)},close:function(){this.es.close(),this.initialized=!1,this.onClose&&this.onClose.call(this)},error:function(t){this.close(),this.retry(),this.errorHandler&&this.errorHandler.call(this,t)},onVisibilityChange:function(){document.hidden?this.close():this.listen()}},t.exports=n},function(t,i){"use strict";t.exports=function(t){return"[object Function]"!==Object.prototype.toString.call(t)?!1:!0}},function(t,i){"use strict";t.exports=function(t){return"[object String]"!==Object.prototype.toString.call(t)?!1:!0}}])});