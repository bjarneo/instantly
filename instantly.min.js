(function(e,a){"object"===typeof exports&&"object"===typeof module?module.exports=a():"function"===typeof define&&define.amd?define("Instantly",[],a):"object"===typeof exports?exports.Instantly=a():e.Instantly=a()})(this,function(){return function(e){function a(b){if(d[b])return d[b].exports;var c=d[b]={i:b,l:!1,exports:{}};e[b].call(c.exports,c,c.exports,a);c.l=!0;return c.exports}var d={};a.m=e;a.c=d;a.i=function(b){return b};a.d=function(b,c,d){a.o(b,c)||Object.defineProperty(b,c,{configurable:!1,
enumerable:!0,get:d})};a.n=function(b){var c=b&&b.__esModule?function(){return b["default"]}:function(){return b};a.d(c,"a",c);return c};a.o=function(b,a){return Object.prototype.hasOwnProperty.call(b,a)};a.p="";return a(a.s=2)}([function(e,a){var d=Object.prototype.toString;e.exports=function(b){var a=typeof b;b=!b||"object"!=a&&"function"!=a?"":d.call(b);return"[object Function]"==b||"[object GeneratorFunction]"==b}},function(e,a){var d=Object.prototype.toString;e.exports=function(b){return"string"==
typeof b||!!b&&"object"==typeof b&&"[object String]"==d.call(b)}},function(e,a,d){function b(b,a){if(!b)throw new TypeError("You need to provide a channel we can listen to!");this.channel=b;a||(a={});a.injectEventSourceNode?this.EventSource=a.injectEventSourceNode:"undefined"!==typeof window&&window.EventSource&&(this.EventSource=window.EventSource);this.origin=a.origin||null;this.retries=a.retries||5;this.timeout=a.timeout||15E3;this.errorHandler=f(a.error)?a.error:null;this.onOpen=f(a.open)?a.open:
null;this.onClose=f(a.close)?a.close:null;a.closeConnNotFocus&&"undefined"!==typeof document&&document.addEventListener("visibilitychange",this.onVisibilityChange.bind(this))}var c=d(1),f=d(0);b.prototype={initialized:!1,callbacks:{},internalRetry:0,on:function(a,b){if(!f(b))throw new TypeError("Callback is not a function");if(!c(a))throw new TypeError("Event is not a string");this.callbacks[a]=b},listen:function(){if(this.EventSource){this.es=new this.EventSource(this.channel);this.es.addEventListener("open",
this.open.bind(this));this.es.addEventListener("error",this.error.bind(this));for(var a in this.callbacks){if(!this.callbacks.hasOwnProperty(a))break;this.generateCallback(a)}}},generateCallback:function(a){this.es.addEventListener(a,function(b){this.origin&&b.origin!==this.origin||("CLOSE"!==b.id&&"CLOSE"!==b.lastEventId||this.close(),this.callbacks[a].call(null,b))}.bind(this))},retry:function(){this.initialized||this.internalRetry===this.retries||setTimeout(function(){this.listen();this.internalRetry++}.bind(this),
this.timeout)},open:function(a){this.initialized=!0;this.internalRetry=0;this.onOpen&&this.onOpen.call(null,a)},close:function(){this.es.close();this.initialized=!1;this.onClose&&this.onClose.call(null)},error:function(a){this.close();this.retry();this.errorHandler&&this.errorHandler.call(null,a)},onVisibilityChange:function(){document.hidden?this.close():this.listen()}};e.exports=b}])});