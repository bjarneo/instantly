(function(e,c){"object"===typeof exports&&"object"===typeof module?module.exports=c():"function"===typeof define&&define.amd?define("Instantly",[],c):"object"===typeof exports?exports.Instantly=c():e.Instantly=c()})(this,function(){return function(e){function c(b){if(d[b])return d[b].exports;var a=d[b]={i:b,l:!1,exports:{}};e[b].call(a.exports,a,a.exports,c);a.l=!0;return a.exports}var d={};c.m=e;c.c=d;c.i=function(b){return b};c.d=function(b,a,d){c.o(b,a)||Object.defineProperty(b,a,{configurable:!1,
enumerable:!0,get:d})};c.n=function(b){var a=b&&b.__esModule?function(){return b["default"]}:function(){return b};c.d(a,"a",a);return a};c.o=function(b,a){return Object.prototype.hasOwnProperty.call(b,a)};c.p="";return c(c.s=0)}([function(e,c){var d=function(b){return"function"===typeof b};c=function(b,a){if(!b)throw new TypeError("You need to provide a channel we can listen to!");this.channel=b;a||(a={});a.injectEventSourceNode?this.EventSource=a.injectEventSourceNode:"undefined"!==typeof window&&
window.EventSource&&(this.EventSource=window.EventSource);this.initialized=!1;this.callbacks={};this.internalRetry=0;this.origin=a.origin||null;this.retries=a.retries||5;this.timeout=a.timeout||15E3;this.errorHandler=d(a.error)?a.error:null;this.onOpen=d(a.open)?a.open:null;this.onClose=d(a.close)?a.close:null;a.closeConnNotFocus&&"undefined"!==typeof document&&document.addEventListener("visibilitychange",this.onVisibilityChange.bind(this))};c.prototype.on=function(b,a){if(!d(a))throw new TypeError("Callback is not a function");
if("string"!==typeof b)throw new TypeError("Event is not a string");this.callbacks[b]=a};c.prototype.listen=function(){if(this.EventSource){this.es=new this.EventSource(this.channel);this.es.addEventListener("open",this.open.bind(this));this.es.addEventListener("error",this.error.bind(this));for(var b in this.callbacks){if(!this.callbacks.hasOwnProperty(b))break;this.generateCallback(b)}}};c.prototype.generateCallback=function(b){this.es.addEventListener(b,function(a){this.origin&&a.origin!==this.origin||
("CLOSE"!==a.id&&"CLOSE"!==a.lastEventId||this.close(),this.callbacks[b].call(null,a))}.bind(this))};c.prototype.retry=function(){this.initialized||this.internalRetry===this.retries||setTimeout(function(){this.listen();this.internalRetry++}.bind(this),this.timeout)};c.prototype.open=function(b){this.initialized=!0;this.internalRetry=0;this.onOpen&&this.onOpen.call(null,b)};c.prototype.close=function(){this.es.close();this.initialized=!1;this.onClose&&this.onClose.call(null)};c.prototype.error=function(b){this.close();
this.retry();this.errorHandler&&this.errorHandler.call(null,b)};c.prototype.onVisibilityChange=function(){document.hidden?this.close():this.listen()};e.exports=c}])});